<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping >
	<class name="org.egov.dms.models.GenericFile" table="EGDMS_GENERIC_FILE"> 
		<id name="id" type="long" column="ID">
	        <generator class="sequence">
	            <param name="sequence">SEQ_EGDMS_GENERIC_FILE</param>
	        </generator>
	    </id>
	    
	    <discriminator column="FILE_TYPE" type="string"/>
		<property column="FILE_TYPE" name="fileType" type="string" insert="false" update="false"/>
	    <property name="fileNumber" type="string" column="FILE_NUMBER" />
	    <property name="fileSummary" type="string" column="FILE_SUMMARY" />
	    <property name="fileSearchTag" type="string" column="FILE_SEARCHTAG" />
	    <property name="fileHeading" type="string" column="FILE_HEADING" />
	    <property name="docNumber" type="string" column="DOC_NUMBER" />
	    
	    <property name="fileReceivedOrSentDate" type="timestamp" column="FILE_RCVD_SENT_DT" />
	    <property name="fileDate" type="timestamp" column="FILE_DATE" />
	    <property name="createdDate" column="CREATED_DATE" type="timestamp" />
		<property name="modifiedDate" column="MODIFIED_DATE" type="timestamp" />
		
		<many-to-one name="department" class="org.egov.lib.rjbac.dept.DepartmentImpl" column="DEPT" fetch="select" />
		<many-to-one name="firstLevelBndry" class="org.egov.lib.admbndry.BoundaryImpl" column="ZONE" />
		<many-to-one name="secondLevelBndry" class="org.egov.lib.admbndry.BoundaryImpl" column = "WARD" />        	
		<many-to-one name="createdBy" class="org.egov.lib.rjbac.user.UserImpl" column="CREATED_BY"  not-null="true" fetch="select" />
		<many-to-one name="modifiedBy" class="org.egov.lib.rjbac.user.UserImpl" column="MODIFIED_BY" not-null="true" fetch="select"/>
		<many-to-one name="state" class="org.egov.infstr.models.State" cascade="all" column = "STATE_ID"/>		        
       	<many-to-one name="fileCategory" class="org.egov.dms.models.FileCategory" column = "CATEGORY" />   
       	<many-to-one name="fileSubcategory" class="org.egov.dms.models.FileCategory" column = "SUB_CATEGORY" />     
       	<many-to-one name="fileStatus" class="org.egov.commons.EgwStatus" column = "STATUS" />
       	<many-to-one name="fileSource" class="org.egov.dms.models.FileSource" column = "SOURCE" />
       	<many-to-one name="filePriority" class="org.egov.dms.models.FilePriority" column = "PRIORITY" />
	    
	    <list name="fileAssignmentDetails" cascade="all,delete-orphan">
			<key column="FILE_ID" not-null="true" />
			<list-index column="ASSIGNMENT_INDEX" />
			<one-to-many
				class="org.egov.dms.models.FileAssignment" />
		</list>
		
	    <subclass name="org.egov.dms.models.InboundFile" discriminator-value="INBOUND">
	    	<join table="EGDMS_INBOUND_FILE">
		        <key column="ID"/>
		        <many-to-one name="receiver" class="org.egov.dms.models.InternalUser" column="RECEIVER" cascade="all"/> 
		        <many-to-one name="sender" class="org.egov.dms.models.ExternalUser" column="SENDER" cascade="all"/>        
	    	</join>
	    </subclass>
	    
	    <subclass name="org.egov.dms.models.InternalFile" discriminator-value="INTERNAL">
		    <join table="EGDMS_INTERNAL_FILE">
		        <key column="ID"/>
		        <many-to-one name="receiver" class="org.egov.dms.models.InternalUser" column="RECEIVER" cascade="all"/> 
		        <many-to-one name="sender" class="org.egov.dms.models.InternalUser" column="SENDER" cascade="all"/>  	               
		    </join>
	    </subclass>
	    <subclass name="org.egov.dms.models.OutboundFile" discriminator-value="OUTBOUND">
		    <join table="EGDMS_OUTBOUND_FILE">
		        <key column="ID"/>  
		        <many-to-one name="receiver" class="org.egov.dms.models.ExternalUser" column="RECEIVER" cascade="all"/> 
		        <many-to-one name="sender" class="org.egov.dms.models.InternalUser" column="SENDER" cascade="all"/>                 
		    </join>
	    </subclass>
	    <subclass name="org.egov.dms.models.NotificationFile" discriminator-value="NOTIFICATION">
	    	<set name="notificationGroups" table="EGDMS_NOTIFY_FILE_GRP_MAPPING" inverse="false" cascade="all-delete-orphan">
				<key column="FILE_ID" foreign-key="ID"/>
				<many-to-many class="org.egov.infstr.workflow.NotificationGroup" column="GROUP_ID" />
			</set>	 
	    	<join table="EGDMS_NOTIFICATION_FILE">
		        <key column="ID"/>	
		        <many-to-one name="sender" class="org.egov.dms.models.ExternalUser" column="SENDER" cascade="all"/>		        		        
		    </join>            
	    </subclass>	   
	</class>
	<query name="DMS-FILE-ID">
	<![CDATA[from org.egov.dms.models.GenericFile where id=?]]>
	</query>
	<query name="DMS-BY-DEPT-TYPE-CAT">
	<![CDATA[from org.egov.dms.models.GenericFile where department.id=? and fileCategory.id=? and fileType=? ]]>
	</query>
	<query name="INBOUND_BY_FILE_NUM">
	<![CDATA[from org.egov.dms.models.InboundFile where fileNumber=?]]>
	</query>
	<query name="OUTBOUND_BY_FILE_NUM">
	<![CDATA[from org.egov.dms.models.OutboundFile where fileNumber=?]]>
	</query>
	<query name="INTERNAL_BY_FILE_NUM">
	<![CDATA[from org.egov.dms.models.InternalFile where fileNumber=?]]>
	</query>
</hibernate-mapping>
