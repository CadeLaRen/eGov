<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<title>
	Scheme Master
</title>
<script language="javascript">
pageMode="modify";
var sameWindow=0;
var str="";
function getData()
{
PageManager.ListService.callListService();
PageValidator.addCalendars();
PageManager.DataService.addNewRow('AddScheme_Grid');
document.getElementById('schemecode').focus();
	var mode = PageManager.DataService.getQueryField('showMode');
	var cgn=PageManager.DataService.getQueryField('code');
	//var worksDetail_code=PageManager.DataService.getQueryField('worksDetail_code');
	
	if (mode == "new")
	{
	document.getElementById('backbutton').style.display='none';
		//alert("inside new");
		//document.getElementById('trModify').style.display='none';
		//document.getElementById('trNew').style.display='block'
		//document.getElementById('gridOpeningBalance').style.display = 'block';
		//document.getElementById('modeOfExec').value="new";
		//
		//document.getElementById('subscheme_id').value = '';
		//document.getElementById('subscheme_name').value = '';
		//document.getElementById('acc_entityId').value = '';
		//document.getElementById('acc_entityKey').value = '';
		//document.getElementById('txnSummary_id').value = '';
	//	document.getElementById('txnSummary_opDr').value = '';
	//	document.getElementById('txnSummary_opCr').value = '';
		//var accEntity=document.getElementById('acc_entity');
		//clearCombo(accEntity);
	}
	/*if (mode == "modify")
	{
		document.getElementById('trModify').style.display='block';
		document.getElementById('trNew').style.display='none'
		document.getElementById('modeOfExec').value="modify";
	//alert(worksDetail_code);
		PageManager.DataService.callDataService('schemeUpdateData');
	}*/

	//added By abdulla
	if(cgn && (mode=="view"))
	 {
		isDrillDown=true;
		PageManager.DataService.setQueryField('code',cgn);
		PageManager.DataService.callDataService('schemeList');
		
		//alert("inside");
		PageManager.DataService.callDataService('getschemeDetails');
		document.getElementById('trNew').style.display ="none";
		document.getElementById('backbutton').style.display='block';
		document.getElementById('adddeleterow').style.display='none';
		disableControls(0,true);
	 }
	 if(cgn && (mode=="modify"))
	 {
			//alert("inside modify");
			PageManager.DataService.setQueryField('code',cgn);
		PageManager.DataService.callDataService('schemeList');
		PageManager.DataService.callDataService('getschemeDetails');
		//document.getElementById('schemecode').style.display ="none";
		//document.forms[0].schemecode.disabled =true;
		//document.forms[0].schemename.disabled =true;
		document.getElementById('schemecode').readOnly =true;
		document.getElementById('schemename').readOnly =true;
		document.getElementById('addschemecode').readOnly =true;
		document.getElementById('addschemename').readOnly =true;
		document.getElementById('fund_id').focus();
		document.getElementById('savenNew').style.display ="none";
		var tab=document.getElementById('AddScheme_Grid');
				if(tab)
				{
					alert("length "+tab.rows.length);
					for(var i=1;i<tab.rows.length;i++)
					{
						PageManager.DataService.getControlInBranch(tab.rows[i],'addschemecode').readOnly=true;
						PageManager.DataService.getControlInBranch(tab.rows[i],'addschemename').readOnly=true;
					}
				}
	 }

	//End

//	alert(document.getElementById('modeOfExec').value);
}
function disableControls(frmIndex, isDisable){
			for(var i=0;i<document.forms[frmIndex].length;i++)
				document.forms[frmIndex].elements[i].disabled =isDisable;
		}
	function fillDate1(objName)
	{
		PageValidator.showCalendar('selectedDate');
		//row = PageManager.DataService.getRow(objName);
		//table = document.getElementById('AddScheme_Grid');
		//ctrl = PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],document.getElementById(objName));
		document.getElementById(objName).value=document.getElementById('selectedDate').value;
		document.getElementById('selectedDate').value = "";
	}

function addrow()
{
	PageManager.DataService.addNewRow('AddScheme_Grid');
}
function deleterow()
{
	PageManager.DataService.deleteRow('AddScheme_Grid');
}
 function getFunId(event) 
 {
		  		clearTable(document.getElementById("completeTable"));
				PageManager.DescService.onblur(event);
}
function Trim(str)
	{  
		while(str.charAt(0) == (" ") )
  			{  str = str.substring(1);
 			 }
 			 while(str.charAt(str.length-1) == " " )
 			 {  str = str.substring(0,str.length-1);
 			 }
 		 return str;
	}	

function ButtonPress(name)
{
	if(name.toLowerCase()=='savenew')
	{
           str="new";
		   sameWindow=1;
	}
    else if(name.toLowerCase()=='saveclose')
	{
            str="close";
			sameWindow=0;
	}
	var buttonvalue=PageManager.DataService.getQueryField('showMode');

	 //PageManager.DataService.setQueryField('modevalue',buttonvalue);
	// alert("mode value "+PageManager.DataService.getQueryField('modevalue'));
	 if (buttonvalue=="modify")
	{
		document.getElementById('modeOfExec').value="modify";
		document.getElementById('codeofscheme').value=PageManager.DataService.getQueryField('code');
	}
	//alert("button value "+buttonvalue);
	if(!PageValidator.validateForm())
				return false;
	 strtDate = document.getElementById('startDate').value;
	 endDate = document.getElementById('endDate').value;
	 var schemecode=document.getElementById('schemecode').value;
	 var schemename=document.getElementById('schemename').value;
	 var isactive=document.getElementById('isActive').value;
	 var fund_id=document.getElementById('fund_id').value;
	 var description=document.getElementById('description').value;

	 var dbDate=document.getElementById('databaseDate').value;
	 if(compareDate(formatDateToDDMMYYYY1(endDate),formatDateToDDMMYYYY1(dbDate)) == -1 )
		{
			alert('End Date should be less than or equal to '+dbDate);
			document.getElementById('endDate').focus();
			return false;
		}
	 if(strtDate.length !=0 && endDate.length !=0)
	   {
		if( compareDate(formatDateToDDMMYYYY1(strtDate),formatDateToDDMMYYYY1(endDate)) == -1 )
		{
			alert('Start Date can not be greater than End Date');
			document.getElementById('startDate').focus();
			return false;
	    }

	   PageManager.DataService.setQueryField('startDate',strtDate);
	   PageManager.DataService.setQueryField('isActive',isactive);
	   PageManager.DataService.setQueryField('endDate',endDate);
	   PageManager.DataService.setQueryField('schemename',schemename);
	   PageManager.DataService.setQueryField('schemecode',schemecode);
	   PageManager.DataService.setQueryField('fund_id',fund_id);
	   PageManager.DataService.setQueryField('description',description);
	   //PageManager.DataService.setQueryField('modeOfExec',buttonvalue);
		// PageManager.DataService.setQueryField('AddScheme_Grid',AddScheme_Grid);
	  }
	 if(strtDate.length !=0 && endDate.length ==0){
	  PageManager.DataService.setQueryField('startDate',formatDate3(strtDate));
	  }
	  if(endDate.length !=0 && strtDate.length ==0){
		 PageManager.DataService.setQueryField('endDate',formatDate3(endDate));
	  }
	/*var fObj = document.getElementById('jbFund_id');
	var fsObj = document.getElementById('jbFundSource_id');
		if(fObj.options[fObj.selectedIndex].text != ""){
	 	PageManager.DataService.setQueryField('fund_id', fObj.options[fObj.selectedIndex].value);
	 	fId=fObj.options[fObj.selectedIndex].value;
		}

		if(fsObj.options[fsObj.selectedIndex].text != ""){
	 	PageManager.DataService.setQueryField('fundSource_id', fsObj.options[fsObj.selectedIndex].value);
		}

	
	 var rowHeader = document.getElementById('mainTable').rows[4];
	rowHeader.style.display='block';*/
	var scheme="";
	var tab=document.getElementById('AddScheme_Grid');
				if(tab)
				{
					var count1 = 0,count2=0;
					for(var i=1;i<tab.rows.length;i++)
					{
						//alert("inside for");
						code=PageManager.DataService.getControlInBranch(tab.rows[i],'addschemecode').value;
						name=PageManager.DataService.getControlInBranch(tab.rows[i],'addschemename').value;
						startDate=PageManager.DataService.getControlInBranch(tab.rows[i],'addstartDate').value;
						subendDate=PageManager.DataService.getControlInBranch(tab.rows[i],'addendDate').value;
						if( compareDate(formatDateToDDMMYYYY1(startDate),formatDateToDDMMYYYY1(subendDate)) == -1 )
						  {
							alert('Start Date can not be greater than End Date');
							return false;
						  }
						 if (compareDate(formatDateToDDMMYYYY1(strtDate),formatDateToDDMMYYYY1(startDate)) == -1 )
						 {
							alert('Sub Scheme Start Date can not be greater than Scheme Start Date');
							return false;
						 }
						  if (compareDate(formatDateToDDMMYYYY1(strtDate),formatDateToDDMMYYYY1(subendDate)) == -1 )
						 {
							alert('Sub Scheme End Date can not be greater than Scheme Start Date');
							return false;
						 }
						 if (Trim(code)!="" || Trim(startDate)!="" || Trim(subendDate)!="" || Trim(name)!="" )
						 {
							if (Trim(startDate)=="" || Trim(subendDate)=="" || Trim(name)=="" || Trim(code)=="")
							{
								alert("Please enter data in all fields in the row");
								return false;
							}
						 }
						 if (Trim(scheme)==Trim(code))
						 {
							alert("Sub Scheme Codes Should not be same");
							return false;
						 }
						 else
						 {
							scheme=code;
						 }

					}
				}
		
				/*if(tab)
				{
					
				}*/

				
	 PageManager.UpdateService.submitForm('getSchemeMaster');				
	//PageManager.DataService.callDataService('getSchemeMaster');

}
/*function afterUpdateService(dc)
{
//alert("inside update ");
	 	disableControls(0,true);
 	if(str=="new")	window.location = "AddScheme.htm?showMode=new"
	if(str=="close") window.close();
}*/
function onClickCancel(){
	//window.location="schemeEnq.htm";
	window.location="AddScheme.htm?showMode=new";
}

function submitAndNew(){
   sameWindow=1;
   onClickModify();
}

function onClickCancelMod(){
	window.location="schemeEnq.htm";

}

/*function submitAndNew(){
   sameWindow=1;
   onClickModify();
}*/
function onClickModify(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	//alert(document.getElementById('modeOfExec').value);
	if(document.getElementById('modeOfExec').value=="new")
	{

		doInsert();
	}
	if(document.getElementById('modeOfExec').value=="modify")
	{

		doUpdate();

		//window.close();
	}

}

function beforeRefreshPage(dc){

	return true;
}
function afterRefreshPage(dc){
	return true;
}
function doInsert(){
	PageManager.UpdateService.submitForm('schemeInsert');
}
function doUpdate(){
		sameWindow = 2;
	PageManager.UpdateService.submitForm('schemeUpdate');
}

function afterUpdateService(dc)
{
	//alert(sameWindow);
	if(sameWindow == 1){
	  window.location="AddScheme.htm?showMode=new";
      }else if(sameWindow == 0)
	  {window.close();}
	  else if(sameWindow == 2) {
	window.location="schemeEnq.htm?showMode=modifyScheme";
	}
	sameWindow=0;
	return true;
}
/*function verifybillCollectorCode(evnt){
	//PageManager.DescService.onblur(evnt);
}*/

</script>
</head><body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onload="getData()" onKeyDown ="CloseWindow(window.self);"><!------------------ Header Begins Begins--------------------->
 <jsp:useBean id = "SchemeMasterBean" scope ="session" class ="com.exilant.eGov.src.master.SchemeMasterBean"/>
<jsp:setProperty name = "SchemeMasterBean" property="*"/>
<form name="addscheme">
<input type="hidden" name="databaseDate"  id="databaseDate">
<input type="hidden" name="worksDetail_code" id="worksDetail_code" >
<input type="hidden" name="egUser_id" id="egUser_id">
<input type="hidden" name="modeOfExec" id="modeOfExec">
<input type="hidden" name="modevalue" id="modevalue" >
<input type="hidden" name="codeofscheme" id="codeofscheme">
<input type="hidden" name="selectedDate" id="selectedDate">

	<table width="100%" border=0 cellpadding="6" cellspacing="0">
		<tr>
			<td valign="top" class="normaltext"><!------------Content begins here ------------------>
				<table width="976" border=0 cellpadding="3" cellspacing="0">
					<tr>
						<td class="rowheader" valign="center" colspan="4" width="968"><span class="headerwhite2" id="screenName"><b>Scheme Master</b></span></td>
					</tr>
					<tr class="row1">
						<td align="right" valign="center" class="normaltext" width="229">
						<div align="right">Scheme Code<span class="leadon">*</span></div></td>
						<td width="731" >
						<input name="schemecode" class="fieldinput" id="schemecode" exilDataType="exilAnyChar" exilMustEnter="true" maxlength=20 exilDataSource="billCodeVerification" exilDescField="scheme_code" size=20>
						</td>
					<!--</tr>
					<tr class="row1">-->
						<td align="right" valign="center" class="normaltext" width="229">
						<div align="right">Scheme Name<span class="leadon">*</span></div></td>
						<td width="731" >
						<input name="schemename" class="fieldinput" id="schemename" exilDataType="exilAnyChar" exilMustEnter="true" maxlength=20 exilDataSource="billCodeVerification" exilDescField="scheme_name" size=20>
						</td>

					</tr>
					<tr class="row1">
						<td><div align="right" valign="center" class="normaltext">Fund Name<span class="leadon">*</span></div></td>
						<td align="left">
							<SELECT name="fund_id" id="fund_id" class="fieldinput" exilListSource="fundNameList" exilMustEnter="true"></SELECT>
						</td>
						<td><div align="right" valign="center" class="normaltext">&nbsp;</div></td>
						<td><div align="right" valign="center" class="normaltext">&nbsp;</div></td>
					</tr>
					<tr class="row1">
						<td align="right" valign="center" class="normaltext" width="229"><div align="right">Start Date<span class="leadon">*</span></div></td>

						<td width="731">
							<input onkeyup="DateFormat(this,this.value,event,false,'3')" name="startDate" id="startDate" class="datefieldinput"  exilDataType="exilAnyDate" exilCalendar="true" exilMustEnter="true"></td>
					<!--</tr>
					<tr class="row2">-->
						<td align="right" valign="center" class="normaltext" width="229"><div align="right">End Date<span class="leadon">*</span></div></td>
						<td width="731">
							<input onkeyup="DateFormat(this,this.value,event,false,'3')" name="endDate" id="endDate" class="datefieldinput"  exilDataType="exilAnyDate" exilCalendar="true" exilMustEnter="true"></td>
					</tr>
                    <tr class="row1">
							  <td><div align="right" valign="center" class="normaltext">Active</div></td>
							  <td><input type="checkbox" name="isActive" id="isActive" value="1" checked>
								</td>
							  <td></td>
							  <td></td>
					</tr>
		  			<tr class="row1">
						<td align="right" valign="center" class="normaltext" width="229"><div align="right">Description</div></td>
						<td width="731" colspan="3">
                                <TEXTAREA id="description" class="narrationfieldinput" name="description" exilTrimLength="20" maxlength=250 rows=3 cols=40 exilDataType="exilAnyChar"></TEXTAREA>
						</td>
					</tr>
				<%-- sub schemes grid start Here--%>
		
        <tr><td id="auto-row">&nbsp;<td/></tr>
					<!--<tr class="row1" >
                    	<td  colspan=4 width="884">&nbsp;</td>
                    </tr>-->
                    <tr class="row2">
			<td height="25" colspan="4" valign="bottom" class="smalltext" width="968"><p class="smalltext"><span class="leadon">*</span>
					- Mandatory Fields</p>
			</td>
		</tr>
			
			</table></TD></TR></TBODY></TABLE></TD></TR></TABLE><!------------ Content ends here ------------------></TD></TR></TABLE></TD><!------------Right Navigation Ends here------------------></TR></TABLE><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
			 <table  width="100%" border="1" cellpadding="0" cellspacing="0" ID="AddScheme_Grid">
                                      <tr class="rowheader">
                                        <td width="10%"  class="columnheader"><div align="center" class="columnheader">Scheme Code</div></td>
                                        <td width="15%"  class="columnheader"><div align="center" class="columnheader">Sub-Scheme&nbsp;Name</div></td>
                                        <td width="10%"><div align="center" class="columnheader">Start Date</div></td>
                                        <td width="10%"><div align="center" class="columnheader">End Date</div></td>
                                        <td width="10%"><div align="center" class="columnheader">Active</div></td>
                                     </tr>
                                       <tr>
                                       <td>
                                       <input class="normaltext" size=10 name="addschemecode" id="addschemecode"  style="WIDTH: 150px; HEIGHT:22px" value="" autocomplete="off" size="20">
                                      
										</td>
                                        <td>
										<input class="normaltext" size=30 name="addschemename" id="addschemename" autocomplete="off" >
										</td>
                                        <td>
										<input class="datefieldinput" style="WIDTH: 150px" name="addstartDate"  id="addstartDate" onkeyup="DateFormat(this,this.value,event,false,'3')"  >
										<!--<A onclick="fillDate1('addstartDate')" tabIndex=-1 href=#><IMG tabIndex=-1 src="../images/calendar.gif"></A>-->
										<!--<input class="fieldinput-left" NAME="addstartDate" id="addstartDate" class="datefieldinput"  exilDataType="exilAnyDate" exilCalendar="true"   SIZE="20">-->

                                        </td>
                                        <td>
											<input class="datefieldinput"  style="WIDTH: 150px"  name="addendDate"  id="addendDate" onkeyup="DateFormat(this,this.value,event,false,'3')"  >
											<!--<A onclick="fillDate1('addendDate')" tabIndex=-1 href=#><IMG tabIndex=-1 src="../images/calendar.gif"></A>-->
											<!--<input class="fieldinput-left"  NAME="addendDate" id="addendDate" class="datefieldinput"  exilDataType="exilAnyDate" exilCalendar="true"   SIZE="20">-->
										</td>
                                        <td>
											<input type="checkbox" name="addisActive" id="addisActive"  checked>
											<!--onKeyDown="addNewRow('AddScheme_Grid','chartOfAccounts_glCode')"-->
                                        </td>
                                      
                                       </tr>

                                      </table>
                                        <tr><td id="auto-row">&nbsp;<td/></tr>
                                      </td></tr><!--new -->


                                  <tr>
			</table>
			<table>
				<tr class="row1" id="adddeleterow">
					<td colspan="2" align="middle" width="898"><!-- Buttons Start Here -->
					<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<!--<td align="center"><IMG height=18 src="../images/Button_leftside.gif" width=7></td>-->
						<td align="middle"><input type="button" onclick="addrow()" value="Add Row"/></td>
						<!--<td><IMG height=18 src="../images/Button_rightside.gif" width=7></td>-->
						<td><IMG src="../images/spacer.gif" width=8></td>
						<!--<td align="right"><IMG height=18 src="../images/Button_leftside.gif" width=7></td>-->
						<td  valign="center"><input type="button"  onclick="deleterow()" value="Delete Row"/></td>
						<!--<td><IMG height=18 src="../images/Button_rightside.gif" width=7></td>-->
					</tr>
					</table>
					</td>
				</tr>
				<tr class="row1">
							<td colspan="4" align="middle" width="898"><!-- Buttons Start Here -->
								<table border="0" cellpadding="0" cellspacing="0">
						
						<tr name="trNew" id="trNew">
						<td align="right"><IMG height=18 src="../images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=savenNew onclick=ButtonPress('savenew') href="#">Save &amp; New</A></td>
						<td><IMG height=18 src="../images/Button_rightside.gif" width=7></td>
						<td><IMG src="../images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="../images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=savenClose onclick=ButtonPress('saveclose') href="#">Save &amp; Close</A></td>
						<td><IMG height=18 src="../images/Button_rightside.gif" width=7></td>
						<td><IMG src="../images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="../images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="../images/Button_second_middle.gif"><A class=buttonsecondary onclick=onClickCancel(); href="#">Cancel</A></td>
						<td><IMG height=18 src="../images/Button_second_rightside.gif" width=6></td>
						<td><IMG src="../images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="../images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="../images/Button_second_middle.gif"><A class=buttonsecondary onclick=window.close() href="#">Close</A></td>
						<td><IMG height=18 src="../images/Button_second_rightside.gif" width=6></td>
						</tr>

						</table><!-- Buttons End Here -->
					</td>
				</tr>
			</table>
			<table id="entities_grid" width="20%" style="DISPLAY: none">
		<tr>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td>
            <input id="grid_detTypeId" name="grid_detTypeId" style="WIDTH: 1px" SIZE="20"></td>
			<td>
            <input id="grid_detKeyId" name="grid_detKeyId" style="WIDTH: 1px" SIZE="20"></td>
			<td>
            <input id="grid_detValue" name="grid_detValue" style="WIDTH: 1px" SIZE="20"></td>
			<td>
            <input id="grid_rowIndex" name="grid_rowIndex" style="WIDTH: 1px" SIZE="20" ></td>
		</tr>
	</table>
	<table border="0" cellpadding="0" cellspacing="0" id=TABLE1 >
			<tr class="row1">
				<td colspan="4"  align="middle" width="898">
					<table border="0" cellpadding="0" cellspacing="0" id="buttons">
						<tr id="backbutton"><td align="center">
							<IMG height=18 src="../images/Button_leftside.gif" width=6></td>
								<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick="back(window.self)"  href="#">Back</A></td>
								<td>
									<IMG height=18 src="../images/Button_rightside.gif" width=6>
								</td>
								<td>
									<IMG src="../../images/spacer.gif" width=8></td>
						</tr>

					</table>
				</td>
			</tr>
		</table>
													
</form>
<div style="position: absolute;top:170px;width:118px;height:30px" id="menu-popup">
		 <table id="completeTable" bgcolor="#cae1ff" border="1"/>
		 </div>
</body>
</html>