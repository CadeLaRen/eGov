pgr.comp.reg.weekly.trend = SELECT TO_CHAR(createddate, 'MM') ||'-'|| TO_CHAR(createddate, 'DD')  AS MONTHDAY,COUNT(*)  AS compno \
FROM egpgr_complaint cd WHERE createddate BETWEEN :fromDate AND :toDate \
GROUP BY TO_CHAR(createddate, 'MM'),TO_CHAR(createddate, 'DD') ORDER BY TO_CHAR(createddate, 'MM'),TO_CHAR(createddate, 'DD')

pgr.comp.resolution.weekly.trend = SELECT SUM(crd.compCnt),crd.days FROM (SELECT COUNT(*) compCnt, TO_CHAR(c.createddate, 'MM-DD') days, c.crn \
FROM egpgr_complaintstatus cs, egpgr_complaint c WHERE c.createddate BETWEEN :fromDate AND :toDate \
AND c.status = cs.id AND cs.name IN ('COMPLETED','REJECTED','WITHDRAWN','CLOSED') GROUP BY TO_CHAR(c.createddate, 'MM-DD'),c.crn ) as crd GROUP BY crd.days

pgr.comp.six.month.aggr = SELECT TO_CHAR(cd.createddate,'MON-yyyy') as mnth ,COUNT(*) compCnt FROM egpgr_complaint cd \
WHERE cd.createddate BETWEEN :fromDate AND :toDate GROUP BY 1 order by 1;

pgr.comp.type.wise.perc = SELECT ct.name ctname, ct.id ctid, count(ct.name) counts FROM egpgr_complaint cd,egpgr_complainttype ct \
WHERE cd.complaintType =ct.id AND cd.createddate BETWEEN :fromDate AND :toDate GROUP BY ct.name, \
ct.id ORDER BY counts DESC

pgr.wardwiseperformance = SELECT a.wardname, COALESCE(a.BefTotalpen,0) noOfCompAsOnBefore14days, COALESCE(a.BefTotalclose,0) Before14daysTotalclose, \
COALESCE(a.AfRecTotal,0) noOfCompReceivedBtwCurrent14days, COALESCE(a.Total_pen,0) noOfCompPenAsonDate , COALESCE(a.AftTotalclose,0) AftTotalclose, \
a.latitude, a.longitude, a.wardid FROM (SELECT bndry.latitude, bndry.longitude,bndry.id AS wardid,bndry.name AS wardname,COALESCE(SUM(CASE WHEN compl.createddate <= :thirteenDaysBefore \
AND cs.name IN('REGISTERED','FORWARDED', 'PROCESSING','REOPENED') THEN 1 END),'0') AS BefTotalpen , COALESCE(SUM(CASE WHEN compl.createddate <= :thirteenDaysBefore \
AND cs.name NOT IN('REGISTERED','FORWARDED', 'PROCESSING','REOPENED') AND state.lastmodifieddate >= :thirteenDaysBefore THEN 1 \
END),'0') AS BefTotalclose , COALESCE(SUM(CASE WHEN compl.createddate >= :fourteenDaysBefore AND compl.createddate <= :currentDate \
THEN 1 END),'0') AS AfRecTotal,COALESCE(SUM(CASE WHEN compl.createddate <= :currentDate AND cs.name IN('REGISTERED','FORWARDED', 'PROCESSING','REOPENED') \
THEN 1 END),'0') AS Total_pen , COALESCE(SUM(CASE WHEN compl.createddate <= :currentDate AND cs.name NOT IN('REGISTERED','FORWARDED', 'PROCESSING','REOPENED') \
THEN 1 END),'0') AS AftTotalclose FROM eg_wf_states state, egpgr_complaintstatus cs, egpgr_complaint compl LEFT JOIN eg_boundary bndry ON compl.location =bndry.id \
WHERE compl.location is not null AND compl.state_id=state.id AND compl.status =cs.id GROUP BY bndry.latitude, bndry.longitude, wardname, wardid ORDER BY wardname) a;

pgr.wardwise.ageing=SELECT COUNT(CASE WHEN cd.createddate < :grtthn90 THEN 1 END) grtthn90, \
COUNT(CASE WHEN cd.createddate BETWEEN :lsthn90 AND :grtthn45 THEN 1 END) btw45to90, \
COUNT(CASE WHEN cd.createddate BETWEEN :lsthn45 AND :grtthn15 THEN 1 END) btw15to45, \
COUNT(CASE WHEN cd.createddate BETWEEN :lsthn15 AND :currdate THEN 1 END) lsthn15 \
FROM egpgr_complaint cd,egpgr_complaintstatus cs,eg_boundary b WHERE cd.status  = cs.id AND cd.location IS NOT NULL \
AND cd.location = b.id AND b.name = :wardName AND cs.name IN ('REGISTERED','FORWARDED', 'PROCESSING','REOPENED');

