<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- Generated Jul 19, 2007 2:57:28 PM by Hibernate Tools 3.2.0.b9 -->
<hibernate-mapping>
	<class name="org.egov.works.models.estimate.AbstractEstimate"
		table="EGW_ABSTRACTESTIMATE">
		<id name="id" type="long">
			<column name="ID" />
			<generator class="sequence">
				<param name="sequence">EGW_ABSTRACTESTIMATE_SEQ</param>
			</generator>
		</id>
		
		<many-to-one name="createdBy" class="org.egov.lib.rjbac.user.UserImpl" column="CREATEDBY" fetch="select" />
		<many-to-one name="modifiedBy" class="org.egov.lib.rjbac.user.UserImpl" column="MODIFIEDBY" fetch="select"/>
		<property name="createdDate" column="CREATEDDATE" type="timestamp" />
		<property column="MODIFIEDDATE" name="modifiedDate" type="timestamp" />
		
		<many-to-one name="egwStatus" column="STATUS_ID" /> 
		
		<many-to-one name="ward"
			class="org.egov.lib.admbndry.BoundaryImpl">
			<column name="WARD" />
		</many-to-one>
		<component name="workValue">
			<property name="value" type="double" precision="2"
				scale="20" />
		</component>
		<many-to-one name="state" class="org.egov.infstr.models.State"
			cascade="all">
			<column name="STATE_ID" />
		</many-to-one>

		<list name="overheadValues" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="oh_index" />
			<one-to-many
				class="org.egov.works.models.estimate.OverheadValue" />
		</list>
		<list name="assetValues" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="ass_index" />
			<one-to-many
				class="org.egov.works.models.estimate.AssetsForEstimate" />
		</list>
		<list name="multiYearEstimates" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="my_index" />
			<one-to-many
				class="org.egov.works.models.estimate.MultiYearEstimate" />
		</list>
		
		<list name="financialDetails" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="fin_index" />
			<one-to-many
				class="org.egov.works.models.estimate.FinancialDetail" />
		</list>
		<list name="activities" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="activity_index" />
			<one-to-many
				class="org.egov.works.models.estimate.Activity" />
		</list>
		<property name="estimateDate" type="date">
			<column name="ESTIMATEDATE" length="7" />
		</property>
		<property name="name" type="string">
			<column name="NAME" length="1024" not-null="true" /> 
		</property>
		<property name="description" type="string">
			<column name="DESCRIPTION" length="1024" not-null="true"/>
		</property>
		<property name="location" type="string">
			<column name="LOCATION" length="250" /> 
		</property>
		<many-to-one name="type"
			class="org.egov.works.models.estimate.WorkType" fetch="select">
			<column name="TYPE" />
		</many-to-one>
		<many-to-one name="depositCode"
			class="org.egov.works.models.masters.DepositCode" fetch="select">
			<column name="DESPOSITCODE_ID" />
		</many-to-one>
		<many-to-one name="category"
			class="org.egov.commons.EgwTypeOfWork" fetch="select"> 
			<column name="CATEGORY" />
		</many-to-one>
		<many-to-one name="parentCategory"
			class="org.egov.commons.EgwTypeOfWork" fetch="select">
			<column name="PARENT_CATEGORY" />
		</many-to-one>
		<many-to-one name="userDepartment"
			class="org.egov.lib.rjbac.dept.DepartmentImpl" fetch="select">
			<column name="USERDEPARTMENT" />
		</many-to-one>
		<many-to-one name="executingDepartment"
			class="org.egov.lib.rjbac.dept.DepartmentImpl" fetch="select">
			<column name="EXECUTINGDEPARTMENT" />
		</many-to-one>
		<many-to-one name="estimatePreparedBy"
			class="org.egov.pims.model.PersonalInformation">
			<column name="PREPAREDBY" />
		</many-to-one>
		<many-to-one name="projectCode" column="PROJECTCODE_ID"
			class="org.egov.works.models.estimate.ProjectCode"
			not-null="false">
		</many-to-one>
		<property name="estimateNumber" type="string">
			<column name="ESTIMATE_NUMBER" length="256" />
		</property>
		<property name="budgetApprNo" type="string">
			<column name="BUDGETAPPRNO" length="256" />
		</property>		
		<property name="documentNumber" type="long">
            <column name="DOCUMENT_NUMBER"/>
        </property>
        <!-- on March23 -->
        <property name="resolutionNumber" type="string">
			<column name="RESOLUTION_NUMBER" length="256" />
		</property>
		<property name="resolutionDate" type="date">
			<column name="RESOLUTION_DATE" length="7" />
		</property>		
		<many-to-one name="fundSource" class="org.egov.commons.Fundsource" fetch="select">
			<column name="FUNDSOURCEID" />
		</many-to-one>
        <property name="document" type="text">
        	<column name="DOCUMENT"></column>
        </property>
        <property name="budgetAvailable">
			<column name="BUDGETAVAILABLE" />
		</property>	
		<property name="budgetRejectionNo" type="string">
			<column name="BUDGETREJECTIONNO" length="256" />
		</property>
		
		<set name="abstractEstimateAppropriations" inverse="true" >
			<key column="ABSTRACTESTIMATE_ID" />
			<one-to-many class="org.egov.works.models.estimate.AbstractEstimateAppropriation"  />
		</set>
		<many-to-one name="oldWard"
			class="org.egov.lib.admbndry.BoundaryImpl">
			<column name="OLD_WARD" />
		</many-to-one>
		<many-to-one name="oldExecDepartment"
			class="org.egov.lib.rjbac.dept.DepartmentImpl" fetch="select">
			<column name="OLD_EXEC_DEPARTMENT" />
		</many-to-one>
		<many-to-one name="oldUserDepartment"
			class="org.egov.lib.rjbac.dept.DepartmentImpl" fetch="select">
			<column name="OLD_USER_DEPARTMENT" />
		</many-to-one>
		<many-to-one name="previousUserDepartment"
			class="org.egov.lib.rjbac.dept.DepartmentImpl" fetch="select">
			<column name="OLD_USER_DEPT_ID" />
		</many-to-one>
		<property name="budgetApprDate" type="date">
			<column name="BUDGET_APPRN_DATE" length="7" />
		</property>
		<property name="oldEstimateNumber" type="string">
			<column name="OLD_ESTIMATE_NUMBER" length="64"/>
		</property>
		<many-to-one name="parent" column="PARENTID" />
		<property name="approvedDate" type="date">
			<column name="approveddate" length="7" />
		</property>	
		
		<property name="isCopiedEst" type="string">
			<column name="IS_COPIED_EST" length="1" />
		</property>	
		<list name="photoList" cascade="all,delete-orphan">
			<key column="abstractestimate_id" not-null="true" />
			<list-index column="col_index" />
			<one-to-many
				class="org.egov.works.models.estimate.EstimatePhoto" />
		</list>
		<property name="lat">
			<column name="LAT"  />
		</property>
		<property name="lon">
			<column name="LON" />
		</property>
		
	</class>
	<query name="MY_NEW_ESTIMATES">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.egwStatus.code='CREATED' and ae.createdBy=?
    ]]>
	</query>
	<query name="MY_APPROVAL_PENDING_ESTIMATES">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.state.owner.id=? and ae.egwStatus.code='CREATED' and ae.state.nextAction!=''
    ]]>
	</query>
	<query name="MY_REJECTED_ESTIMATES">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.state.owner.id=? and ae.egwStatus.code='REJECTED'
    ]]>
	</query>
	<query name="ALL_ESTIMATES_BY_STATUS">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.egwStatus.code=? order by ae.executingDepartment.deptName
    ]]>
	</query>
	<query name="ALL_ESTIMATES_BY_EXECUTINGDEPARTMENT">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.egwStatus.code=? and ae.executingDepartment.deptName = ? order by ae.executingDepartment.deptName
    ]]>
	</query>
	<query name="MY_TECH_SANCTIONED_ESTIMATES">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.state.owner.id=? and ae.egwStatus.code='TECH_SANCTIONED'
    ]]>
	</query>
	<query name="MY_CANCELLED_ESTIMATES">
		<![CDATA[
     	from AbstractEstimate as ae where ae.parent is null and ae.state.owner.id=? and ae.egwStatus.code='CANCELLED'
    ]]>
	</query>
	<query name="getAbEstimateListById">
		<![CDATA[
     	from AbstractEstimate ab where ab.id in(:param_0)
    	]]>
	</query>
	<query name="REVISION_ESTIMATES_BY_ESTID">
		<![CDATA[
     	from AbstractEstimate ae where ae.parent.id=? and ae.egwStatus.code='APPROVED' order by ae.id 
    ]]>
	</query>
	<query name="GET_UNCANCELLED_ESTIMATES_FOR_RATECONTRACT">
		<![CDATA[
     	from AbstractEstimate where  egwStatus.code!='CANCELLED' and rateContract.id = ? and id!=? and createdDate < ? 
    ]]>
	</query>
	<query name="REVISION_ESTIMATES_BY_ESTID_WOID">
		<![CDATA[
     	from AbstractEstimate ae where ae.parent.id=? and ae.egwStatus.code='APPROVED' and 
     	EXISTS (select woe.estimate.id from WorkOrderEstimate woe where woe.estimate.id = ae.id and woe.workOrder.parent.id = ?) order by ae.id 
    ]]>
	</query>
</hibernate-mapping>
